// theme-control.js
const template = document.createElement('template');
template.innerHTML = `
  <link rel="stylesheet" href="/assets/css/components/button.css">
  <style>
    :host { display: inline-block;anchor-name:--theme-button; }
    button { display: none; }
    .slider {
      position: relative;
      width: 250px;
      height: 250px;
      touch-action: none;
    }
    svg {
      display: block;
      width: 100%;
      height: 100%;
    }
    @media screen and (max-width: 800px), (max-height: 500px) {
      button { 
        display: inline-flex;
        
      }
    }

    [popover] {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      margin: 0;
      z-index: 20;
    }
  </style>
  <button id="toggle" class="button sm" aria-label="Theme controls"><span class="icon">tune</span> Theme</button>
  <div class="slider" id="slider">
   <svg width="250" height="250" viewBox="0 0 250 250" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<path d="M15 169.664L3.625 169.664L3.625 168.438L8.51563 168.438L8.51563 162.719L3.625 162.719L3.625 161.5L15 161.5L15 162.719L9.75 162.719L9.75 168.438L15 168.438L15 169.664ZM15 158.961L6.82813 158.961L6.82813 157.781L15 157.781L15 158.961ZM4.28906 159.203C4.0651 159.203 3.8776 159.133 3.72656 158.992C3.57031 158.846 3.49219 158.641 3.49219 158.375C3.49219 158.104 3.57031 157.898 3.72656 157.758C3.8776 157.617 4.0651 157.547 4.28906 157.547C4.51302 157.547 4.70313 157.617 4.85938 157.758C5.01042 157.898 5.08594 158.104 5.08594 158.375C5.08594 158.641 5.01042 158.846 4.85938 158.992C4.70313 159.133 4.51302 159.203 4.28906 159.203ZM17.2031 155.578L16.1484 154.695C16.4036 154.482 16.6328 154.182 16.8359 153.797C17.0443 153.406 17.1484 152.966 17.1484 152.477C17.1484 151.846 16.9453 151.328 16.5391 150.922C16.138 150.516 15.5677 150.313 14.8281 150.313L14.0156 150.313C14.3646 150.547 14.6432 150.862 14.8516 151.258C15.0547 151.654 15.1563 152.128 15.1563 152.68C15.1563 153.669 14.7682 154.453 13.9922 155.031C13.2161 155.609 12.2318 155.898 11.0391 155.898L10.7891 155.898C9.59636 155.898 8.61198 155.609 7.83594 155.031C7.0599 154.453 6.67188 153.669 6.67188 152.68C6.67188 152.112 6.79167 151.62 7.03125 151.203C7.27083 150.786 7.56511 150.479 7.91406 150.281L7.91406 150.242L6.82813 150.195L6.82813 149.125L14.8281 149.125C15.9844 149.125 16.8698 149.443 17.4844 150.078C18.099 150.708 18.4063 151.513 18.4063 152.492C18.4063 153.128 18.2891 153.716 18.0547 154.258C17.8255 154.794 17.5417 155.234 17.2031 155.578ZM11.0391 154.688C11.8672 154.688 12.5625 154.508 13.125 154.148C13.6875 153.784 13.9688 153.211 13.9688 152.43C13.9688 151.909 13.8255 151.466 13.5391 151.102C13.2526 150.737 12.9349 150.474 12.5859 150.313L9.24219 150.313C8.87761 150.479 8.55729 150.745 8.28125 151.109C8 151.469 7.85938 151.909 7.85938 152.43C7.85938 153.211 8.14063 153.784 8.70313 154.148C9.26563 154.508 9.96094 154.688 10.7891 154.688L11.0391 154.688ZM15 146.828L3.03125 146.828L3.03125 145.641L7.85938 145.641C7.47917 145.365 7.1875 145.016 6.98438 144.594C6.77604 144.172 6.67188 143.701 6.67188 143.18C6.67188 142.451 6.90625 141.857 7.375 141.398C7.84375 140.94 8.625 140.711 9.71875 140.711L15 140.711L15 141.898L9.71875 141.898C9.0625 141.898 8.59375 142.047 8.3125 142.344C8.03125 142.635 7.89063 143.049 7.89063 143.586C7.89063 144.055 8.00781 144.466 8.24219 144.82C8.47656 145.169 8.78906 145.443 9.17969 145.641L15 145.641L15 146.828ZM9.67188 134.898L8.95313 134.898C7.19792 134.898 5.83333 134.479 4.85938 133.641C3.88021 132.797 3.39063 131.737 3.39063 130.461C3.39063 129.195 3.76042 128.206 4.5 127.492C5.23958 126.773 6.13542 126.414 7.1875 126.414L7.27344 126.414L7.27344 127.633L7.1875 127.633C6.47917 127.638 5.88281 127.875 5.39844 128.344C4.91406 128.813 4.67188 129.518 4.67188 130.461C4.67188 131.398 5.03125 132.167 5.75 132.766C6.46354 133.365 7.53125 133.664 8.95313 133.664L9.67188 133.664C11.0104 133.664 12.0599 133.365 12.8203 132.766C13.5755 132.167 13.9531 131.398 13.9531 130.461C13.9531 129.555 13.7083 128.872 13.2188 128.414C12.7292 127.951 12.1354 127.693 11.4375 127.641L11.3516 127.633L11.3516 126.414L11.4375 126.414C12.4844 126.492 13.3802 126.87 14.125 127.547C14.8646 128.224 15.2344 129.195 15.2344 130.461C15.2344 131.742 14.7474 132.802 13.7734 133.641C12.7943 134.479 11.4271 134.898 9.67188 134.898ZM11.0391 125.102L10.7891 125.102C9.55469 125.102 8.54948 124.776 7.77344 124.125C6.99219 123.474 6.60156 122.602 6.60156 121.508C6.60156 120.414 6.99219 119.542 7.77344 118.891C8.54948 118.234 9.55469 117.906 10.7891 117.906L11.0391 117.906C12.2734 117.906 13.2813 118.234 14.0625 118.891C14.8438 119.542 15.2344 120.414 15.2344 121.508C15.2344 122.602 14.8438 123.474 14.0625 124.125C13.2813 124.776 12.2734 125.102 11.0391 125.102ZM10.7891 123.891L11.0391 123.891C11.8828 123.891 12.5964 123.69 13.1797 123.289C13.7578 122.888 14.0469 122.294 14.0469 121.508C14.0469 120.716 13.7578 120.12 13.1797 119.719C12.5964 119.318 11.8828 119.117 11.0391 119.117L10.7891 119.117C9.94531 119.117 9.23438 119.318 8.65625 119.719C8.07292 120.12 7.78125 120.716 7.78125 121.508C7.78125 122.294 8.07292 122.888 8.65625 123.289C9.23438 123.69 9.94531 123.891 10.7891 123.891ZM15 116.109L6.82813 116.109L6.82813 115.039L7.89844 114.992L7.89844 114.953C7.51823 114.677 7.21875 114.333 7 113.922C6.78125 113.505 6.67188 113.042 6.67188 112.531C6.67188 111.755 6.90625 111.138 7.375 110.68C7.84375 110.221 8.62761 109.992 9.72656 109.992L15 109.992L15 111.18L9.71875 111.18C9.0625 111.18 8.59375 111.328 8.3125 111.625C8.03125 111.917 7.89063 112.333 7.89063 112.875C7.89063 113.339 8.00781 113.745 8.24219 114.094C8.47136 114.438 8.77865 114.714 9.16406 114.922L15 114.922L15 116.109ZM7.9375 108.93L6.82813 108.93L6.82813 104.516L7.9375 104.516L7.9375 108.93ZM12.9609 107.469L7.49219 107.469L7.26563 107.469L4.76563 107.469L4.76563 106.281L12.9609 106.281C13.3307 106.281 13.5964 106.206 13.7578 106.055C13.9141 105.904 13.9922 105.664 13.9922 105.336C13.9922 105.195 13.9766 105.06 13.9453 104.93C13.9141 104.794 13.8724 104.659 13.8203 104.523L15 104.523C15.0625 104.643 15.1172 104.802 15.1641 105C15.2109 105.198 15.2344 105.411 15.2344 105.641C15.2344 106.203 15.0547 106.648 14.6953 106.977C14.3307 107.305 13.7526 107.469 12.9609 107.469ZM15 102.984L6.82813 102.984L6.82813 101.914L7.96875 101.867L7.96875 101.828C7.58854 101.625 7.26563 101.354 7 101.016C6.73438 100.677 6.60156 100.273 6.60156 99.8047C6.60156 99.6901 6.61458 99.5703 6.64063 99.4453C6.66146 99.3203 6.68229 99.2318 6.70313 99.1797L8.04688 99.1797C8.02604 99.2839 8.01042 99.3932 8 99.5078C7.98958 99.6224 7.98438 99.7474 7.98438 99.8828C7.98438 100.336 8.09636 100.724 8.32031 101.047C8.54427 101.37 8.82813 101.62 9.17188 101.797L15 101.797L15 102.984ZM12.5938 98.5781C11.7656 98.5781 11.1224 98.2734 10.6641 97.6641C10.2005 97.0547 9.96875 96.276 9.96875 95.3281L9.96875 93.4766L9.39844 93.4766C8.90886 93.4766 8.51302 93.6042 8.21094 93.8594C7.90365 94.1146 7.75 94.5547 7.75 95.1797C7.75 95.7995 7.87761 96.2448 8.13281 96.5156C8.38802 96.7865 8.6849 96.9219 9.02344 96.9219L9.07031 96.9219L9.07031 98.0938L9.01563 98.0938C8.36979 98.0938 7.80729 97.8307 7.32813 97.3047C6.84375 96.7786 6.60156 96.0573 6.60156 95.1406C6.60156 94.2344 6.83594 93.5339 7.30469 93.0391C7.76823 92.5391 8.46615 92.2891 9.39844 92.2891L13.125 92.2891C13.4635 92.2891 13.7839 92.263 14.0859 92.2109C14.3828 92.1589 14.6458 92.0859 14.875 91.9922L15 91.9922L15 93.1328C14.8698 93.2109 14.7005 93.2786 14.4922 93.3359C14.2839 93.3932 14.0755 93.4323 13.8672 93.4531C14.2057 93.6406 14.5052 93.9453 14.7656 94.3672C15.026 94.7891 15.1563 95.3255 15.1563 95.9766C15.1563 96.7161 14.9375 97.3359 14.5 97.8359C14.0573 98.3307 13.4219 98.5781 12.5938 98.5781ZM12.5234 97.3906C12.987 97.3906 13.349 97.2552 13.6094 96.9844C13.8698 96.7135 14 96.2943 14 95.7266C14 95.1536 13.8047 94.6354 13.4141 94.1719C13.0182 93.7083 12.599 93.4766 12.1563 93.4766L11 93.4766L11 95.1719C11 95.9063 11.138 96.4609 11.4141 96.8359C11.6849 97.2057 12.0547 97.3906 12.5234 97.3906ZM12.5859 90.5547L12.5859 89.3672L12.625 89.3672C13.099 89.3672 13.4557 89.1927 13.6953 88.8438C13.9349 88.4948 14.0547 88.0365 14.0547 87.4688C14.0547 86.9323 13.9375 86.5 13.7031 86.1719C13.4688 85.8438 13.1667 85.6797 12.7969 85.6797C12.4375 85.6797 12.1458 85.8073 11.9219 86.0625C11.6979 86.3125 11.4818 86.8411 11.2734 87.6484C11.0495 88.5026 10.7604 89.1667 10.4063 89.6406C10.0521 90.1146 9.55208 90.3516 8.90625 90.3516C8.23438 90.3516 7.68229 90.0964 7.25 89.5859C6.81771 89.0703 6.60156 88.3802 6.60156 87.5156C6.60156 86.6563 6.82031 85.9661 7.25781 85.4453C7.69531 84.9245 8.29948 84.6641 9.07031 84.6641L9.11719 84.6641L9.11719 85.8438L9.04688 85.8438C8.65104 85.8438 8.34115 85.9844 8.11719 86.2656C7.89323 86.5417 7.78125 86.9583 7.78125 87.5156C7.78125 88.0729 7.88542 88.4792 8.09375 88.7344C8.29688 88.9896 8.5625 89.1172 8.89063 89.1172C9.21354 89.1172 9.47396 88.974 9.67188 88.6875C9.86458 88.401 10.0651 87.8438 10.2734 87.0156C10.4818 86.1875 10.7786 85.5547 11.1641 85.1172C11.5443 84.6745 12.0833 84.4531 12.7813 84.4531C13.4844 84.4531 14.0703 84.7057 14.5391 85.2109C15.0026 85.7161 15.2344 86.4714 15.2344 87.4766C15.2344 88.4818 14.9974 89.2474 14.5234 89.7734C14.0495 90.2943 13.4167 90.5547 12.625 90.5547L12.5859 90.5547ZM7.9375 83.8203L6.82813 83.8203L6.82813 79.4063L7.9375 79.4063L7.9375 83.8203ZM12.9609 82.3594L7.49219 82.3594L7.26563 82.3594L4.76563 82.3594L4.76563 81.1719L12.9609 81.1719C13.3307 81.1719 13.5964 81.0964 13.7578 80.9453C13.9141 80.7943 13.9922 80.5547 13.9922 80.2266C13.9922 80.0859 13.9766 79.9505 13.9453 79.8203C13.9141 79.6849 13.8724 79.5495 13.8203 79.4141L15 79.4141C15.0625 79.5339 15.1172 79.6927 15.1641 79.8906C15.2109 80.0885 15.2344 80.3021 15.2344 80.5313C15.2344 81.0938 15.0547 81.5391 14.6953 81.8672C14.3307 82.1953 13.7526 82.3594 12.9609 82.3594Z" fill="#565E6A" style="fill:#565E6A;fill:color(display-p3 0.3390 0.3689 0.4171);fill-opacity:1;"/>
<path d="M80.3359 245V233.625H81.5625V238.516H87.2812V233.625H88.5V245H87.2812V239.75H81.5625V245H80.3359ZM91.0391 245V236.828H92.2188V245H91.0391ZM90.7969 234.289C90.7969 234.065 90.8672 233.878 91.0078 233.727C91.1536 233.57 91.3594 233.492 91.625 233.492C91.8958 233.492 92.1016 233.57 92.2422 233.727C92.3828 233.878 92.4531 234.065 92.4531 234.289C92.4531 234.513 92.3828 234.703 92.2422 234.859C92.1016 235.01 91.8958 235.086 91.625 235.086C91.3594 235.086 91.1536 235.01 91.0078 234.859C90.8672 234.703 90.7969 234.513 90.7969 234.289ZM94.4219 247.203L95.3047 246.148C95.5182 246.404 95.8177 246.633 96.2031 246.836C96.5938 247.044 97.0339 247.148 97.5234 247.148C98.1536 247.148 98.6719 246.945 99.0781 246.539C99.4844 246.138 99.6875 245.568 99.6875 244.828V244.016C99.4531 244.365 99.138 244.643 98.7422 244.852C98.3464 245.055 97.8724 245.156 97.3203 245.156C96.3307 245.156 95.5469 244.768 94.9688 243.992C94.3906 243.216 94.1016 242.232 94.1016 241.039V240.789C94.1016 239.596 94.3906 238.612 94.9688 237.836C95.5469 237.06 96.3307 236.672 97.3203 236.672C97.888 236.672 98.3802 236.792 98.7969 237.031C99.2135 237.271 99.5208 237.565 99.7188 237.914H99.7578L99.8047 236.828H100.875V244.828C100.875 245.984 100.557 246.87 99.9219 247.484C99.2917 248.099 98.487 248.406 97.5078 248.406C96.8724 248.406 96.2839 248.289 95.7422 248.055C95.2057 247.826 94.7656 247.542 94.4219 247.203ZM95.3125 241.039C95.3125 241.867 95.4922 242.562 95.8516 243.125C96.2161 243.688 96.7891 243.969 97.5703 243.969C98.0911 243.969 98.5339 243.826 98.8984 243.539C99.263 243.253 99.526 242.935 99.6875 242.586V239.242C99.5208 238.878 99.2552 238.557 98.8906 238.281C98.5312 238 98.0911 237.859 97.5703 237.859C96.7891 237.859 96.2161 238.141 95.8516 238.703C95.4922 239.266 95.3125 239.961 95.3125 240.789V241.039ZM103.172 245V233.031H104.359V237.859C104.635 237.479 104.984 237.188 105.406 236.984C105.828 236.776 106.299 236.672 106.82 236.672C107.549 236.672 108.143 236.906 108.602 237.375C109.06 237.844 109.289 238.625 109.289 239.719V245H108.102V239.719C108.102 239.062 107.953 238.594 107.656 238.312C107.365 238.031 106.951 237.891 106.414 237.891C105.945 237.891 105.534 238.008 105.18 238.242C104.831 238.477 104.557 238.789 104.359 239.18V245H103.172ZM115.102 239.672V238.953C115.102 237.198 115.521 235.833 116.359 234.859C117.203 233.88 118.263 233.391 119.539 233.391C120.805 233.391 121.794 233.76 122.508 234.5C123.227 235.24 123.586 236.135 123.586 237.188V237.273H122.367V237.188C122.362 236.479 122.125 235.883 121.656 235.398C121.188 234.914 120.482 234.672 119.539 234.672C118.602 234.672 117.833 235.031 117.234 235.75C116.635 236.464 116.336 237.531 116.336 238.953V239.672C116.336 241.01 116.635 242.06 117.234 242.82C117.833 243.576 118.602 243.953 119.539 243.953C120.445 243.953 121.128 243.708 121.586 243.219C122.049 242.729 122.307 242.135 122.359 241.438L122.367 241.352H123.586V241.438C123.508 242.484 123.13 243.38 122.453 244.125C121.776 244.865 120.805 245.234 119.539 245.234C118.258 245.234 117.198 244.747 116.359 243.773C115.521 242.794 115.102 241.427 115.102 239.672ZM124.898 241.039V240.789C124.898 239.555 125.224 238.549 125.875 237.773C126.526 236.992 127.398 236.602 128.492 236.602C129.586 236.602 130.458 236.992 131.109 237.773C131.766 238.549 132.094 239.555 132.094 240.789V241.039C132.094 242.273 131.766 243.281 131.109 244.062C130.458 244.844 129.586 245.234 128.492 245.234C127.398 245.234 126.526 244.844 125.875 244.062C125.224 243.281 124.898 242.273 124.898 241.039ZM126.109 240.789V241.039C126.109 241.883 126.31 242.596 126.711 243.18C127.112 243.758 127.706 244.047 128.492 244.047C129.284 244.047 129.88 243.758 130.281 243.18C130.682 242.596 130.883 241.883 130.883 241.039V240.789C130.883 239.945 130.682 239.234 130.281 238.656C129.88 238.073 129.284 237.781 128.492 237.781C127.706 237.781 127.112 238.073 126.711 238.656C126.31 239.234 126.109 239.945 126.109 240.789ZM133.891 245V236.828H134.961L135.008 237.898H135.047C135.323 237.518 135.667 237.219 136.078 237C136.495 236.781 136.958 236.672 137.469 236.672C138.245 236.672 138.862 236.906 139.32 237.375C139.779 237.844 140.008 238.628 140.008 239.727V245H138.82V239.719C138.82 239.062 138.672 238.594 138.375 238.312C138.083 238.031 137.667 237.891 137.125 237.891C136.661 237.891 136.255 238.008 135.906 238.242C135.562 238.471 135.286 238.779 135.078 239.164V245H133.891ZM141.07 237.938V236.828H145.484V237.938H141.07ZM142.531 242.961V237.492V237.266V234.766H143.719V242.961C143.719 243.331 143.794 243.596 143.945 243.758C144.096 243.914 144.336 243.992 144.664 243.992C144.805 243.992 144.94 243.977 145.07 243.945C145.206 243.914 145.341 243.872 145.477 243.82V245C145.357 245.062 145.198 245.117 145 245.164C144.802 245.211 144.589 245.234 144.359 245.234C143.797 245.234 143.352 245.055 143.023 244.695C142.695 244.331 142.531 243.753 142.531 242.961ZM147.016 245V236.828H148.086L148.133 237.969H148.172C148.375 237.589 148.646 237.266 148.984 237C149.323 236.734 149.727 236.602 150.195 236.602C150.31 236.602 150.43 236.615 150.555 236.641C150.68 236.661 150.768 236.682 150.82 236.703V238.047C150.716 238.026 150.607 238.01 150.492 238C150.378 237.99 150.253 237.984 150.117 237.984C149.664 237.984 149.276 238.096 148.953 238.32C148.63 238.544 148.38 238.828 148.203 239.172V245H147.016ZM151.422 242.594C151.422 241.766 151.727 241.122 152.336 240.664C152.945 240.201 153.724 239.969 154.672 239.969H156.523V239.398C156.523 238.909 156.396 238.513 156.141 238.211C155.885 237.904 155.445 237.75 154.82 237.75C154.201 237.75 153.755 237.878 153.484 238.133C153.214 238.388 153.078 238.685 153.078 239.023V239.07H151.906V239.016C151.906 238.37 152.169 237.807 152.695 237.328C153.221 236.844 153.943 236.602 154.859 236.602C155.766 236.602 156.466 236.836 156.961 237.305C157.461 237.768 157.711 238.466 157.711 239.398V243.125C157.711 243.464 157.737 243.784 157.789 244.086C157.841 244.383 157.914 244.646 158.008 244.875V245H156.867C156.789 244.87 156.721 244.701 156.664 244.492C156.607 244.284 156.568 244.076 156.547 243.867C156.359 244.206 156.055 244.505 155.633 244.766C155.211 245.026 154.674 245.156 154.023 245.156C153.284 245.156 152.664 244.938 152.164 244.5C151.669 244.057 151.422 243.422 151.422 242.594ZM152.609 242.523C152.609 242.987 152.745 243.349 153.016 243.609C153.286 243.87 153.706 244 154.273 244C154.846 244 155.365 243.805 155.828 243.414C156.292 243.018 156.523 242.599 156.523 242.156V241H154.828C154.094 241 153.539 241.138 153.164 241.414C152.794 241.685 152.609 242.055 152.609 242.523ZM159.445 242.586H160.633V242.625C160.633 243.099 160.807 243.456 161.156 243.695C161.505 243.935 161.964 244.055 162.531 244.055C163.068 244.055 163.5 243.938 163.828 243.703C164.156 243.469 164.32 243.167 164.32 242.797C164.32 242.438 164.193 242.146 163.938 241.922C163.688 241.698 163.159 241.482 162.352 241.273C161.497 241.049 160.833 240.76 160.359 240.406C159.885 240.052 159.648 239.552 159.648 238.906C159.648 238.234 159.904 237.682 160.414 237.25C160.93 236.818 161.62 236.602 162.484 236.602C163.344 236.602 164.034 236.82 164.555 237.258C165.076 237.695 165.336 238.299 165.336 239.07V239.117H164.156V239.047C164.156 238.651 164.016 238.341 163.734 238.117C163.458 237.893 163.042 237.781 162.484 237.781C161.927 237.781 161.521 237.885 161.266 238.094C161.01 238.297 160.883 238.562 160.883 238.891C160.883 239.214 161.026 239.474 161.312 239.672C161.599 239.865 162.156 240.065 162.984 240.273C163.812 240.482 164.445 240.779 164.883 241.164C165.326 241.544 165.547 242.083 165.547 242.781C165.547 243.484 165.294 244.07 164.789 244.539C164.284 245.003 163.529 245.234 162.523 245.234C161.518 245.234 160.753 244.997 160.227 244.523C159.706 244.049 159.445 243.417 159.445 242.625V242.586ZM166.18 237.938V236.828H170.594V237.938H166.18ZM167.641 242.961V237.492V237.266V234.766H168.828V242.961C168.828 243.331 168.904 243.596 169.055 243.758C169.206 243.914 169.445 243.992 169.773 243.992C169.914 243.992 170.049 243.977 170.18 243.945C170.315 243.914 170.451 243.872 170.586 243.82V245C170.466 245.062 170.307 245.117 170.109 245.164C169.911 245.211 169.698 245.234 169.469 245.234C168.906 245.234 168.461 245.055 168.133 244.695C167.805 244.331 167.641 243.753 167.641 242.961Z" fill="#565E6A" style="fill:#565E6A;fill:color(display-p3 0.3390 0.3689 0.4171);fill-opacity:1;"/>
<rect x="24.5" y="24.5" width="201" height="201" fill="#FCFCFC" style="fill:#FCFCFC;fill:color(display-p3 0.9868 0.9868 0.9868);fill-opacity:1;"/>
<rect x="24.5" y="24.5" width="201" height="201" fill="url(#pattern0_36785_629)" style=""/>
<rect x="24.5" y="24.5" width="201" height="201" fill="url(#paint0_linear_36785_629)" style="" style="mix-blend-mode:screen;opacity:0.5"/>
<rect x="24.5" y="24.5" width="201" height="201" stroke="#E4E4E6" style="stroke:#E4E4E6;stroke:color(display-p3 0.8927 0.8959 0.9011);stroke-opacity:1;"/>
<rect class="handle" width="27" height="27" fill="#51B3D0" style="fill:#51B3D0;fill:color(display-p3 0.3178 0.7026 0.8151);fill-opacity:1;"/>
<path d="M80.3359 15V3.625H81.5625V8.51562H87.2812V3.625H88.5V15H87.2812V9.75H81.5625V15H80.3359ZM91.0391 15V6.82812H92.2188V15H91.0391ZM90.7969 4.28906C90.7969 4.0651 90.8672 3.8776 91.0078 3.72656C91.1536 3.57031 91.3594 3.49219 91.625 3.49219C91.8958 3.49219 92.1016 3.57031 92.2422 3.72656C92.3828 3.8776 92.4531 4.0651 92.4531 4.28906C92.4531 4.51302 92.3828 4.70312 92.2422 4.85938C92.1016 5.01042 91.8958 5.08594 91.625 5.08594C91.3594 5.08594 91.1536 5.01042 91.0078 4.85938C90.8672 4.70312 90.7969 4.51302 90.7969 4.28906ZM94.4219 17.2031L95.3047 16.1484C95.5182 16.4036 95.8177 16.6328 96.2031 16.8359C96.5938 17.0443 97.0339 17.1484 97.5234 17.1484C98.1536 17.1484 98.6719 16.9453 99.0781 16.5391C99.4844 16.138 99.6875 15.5677 99.6875 14.8281V14.0156C99.4531 14.3646 99.138 14.6432 98.7422 14.8516C98.3464 15.0547 97.8724 15.1562 97.3203 15.1562C96.3307 15.1562 95.5469 14.7682 94.9688 13.9922C94.3906 13.2161 94.1016 12.2318 94.1016 11.0391V10.7891C94.1016 9.59635 94.3906 8.61198 94.9688 7.83594C95.5469 7.0599 96.3307 6.67188 97.3203 6.67188C97.888 6.67188 98.3802 6.79167 98.7969 7.03125C99.2135 7.27083 99.5208 7.5651 99.7188 7.91406H99.7578L99.8047 6.82812H100.875V14.8281C100.875 15.9844 100.557 16.8698 99.9219 17.4844C99.2917 18.099 98.487 18.4062 97.5078 18.4062C96.8724 18.4062 96.2839 18.2891 95.7422 18.0547C95.2057 17.8255 94.7656 17.5417 94.4219 17.2031ZM95.3125 11.0391C95.3125 11.8672 95.4922 12.5625 95.8516 13.125C96.2161 13.6875 96.7891 13.9688 97.5703 13.9688C98.0911 13.9688 98.5339 13.8255 98.8984 13.5391C99.263 13.2526 99.526 12.9349 99.6875 12.5859V9.24219C99.5208 8.8776 99.2552 8.55729 98.8906 8.28125C98.5312 8 98.0911 7.85938 97.5703 7.85938C96.7891 7.85938 96.2161 8.14062 95.8516 8.70312C95.4922 9.26562 95.3125 9.96094 95.3125 10.7891V11.0391ZM103.172 15V3.03125H104.359V7.85938C104.635 7.47917 104.984 7.1875 105.406 6.98438C105.828 6.77604 106.299 6.67188 106.82 6.67188C107.549 6.67188 108.143 6.90625 108.602 7.375C109.06 7.84375 109.289 8.625 109.289 9.71875V15H108.102V9.71875C108.102 9.0625 107.953 8.59375 107.656 8.3125C107.365 8.03125 106.951 7.89062 106.414 7.89062C105.945 7.89062 105.534 8.00781 105.18 8.24219C104.831 8.47656 104.557 8.78906 104.359 9.17969V15H103.172ZM115.102 9.67188V8.95312C115.102 7.19792 115.521 5.83333 116.359 4.85938C117.203 3.88021 118.263 3.39062 119.539 3.39062C120.805 3.39062 121.794 3.76042 122.508 4.5C123.227 5.23958 123.586 6.13542 123.586 7.1875V7.27344H122.367V7.1875C122.362 6.47917 122.125 5.88281 121.656 5.39844C121.188 4.91406 120.482 4.67188 119.539 4.67188C118.602 4.67188 117.833 5.03125 117.234 5.75C116.635 6.46354 116.336 7.53125 116.336 8.95312V9.67188C116.336 11.0104 116.635 12.0599 117.234 12.8203C117.833 13.5755 118.602 13.9531 119.539 13.9531C120.445 13.9531 121.128 13.7083 121.586 13.2188C122.049 12.7292 122.307 12.1354 122.359 11.4375L122.367 11.3516H123.586V11.4375C123.508 12.4844 123.13 13.3802 122.453 14.125C121.776 14.8646 120.805 15.2344 119.539 15.2344C118.258 15.2344 117.198 14.7474 116.359 13.7734C115.521 12.7943 115.102 11.4271 115.102 9.67188ZM124.898 11.0391V10.7891C124.898 9.55469 125.224 8.54948 125.875 7.77344C126.526 6.99219 127.398 6.60156 128.492 6.60156C129.586 6.60156 130.458 6.99219 131.109 7.77344C131.766 8.54948 132.094 9.55469 132.094 10.7891V11.0391C132.094 12.2734 131.766 13.2812 131.109 14.0625C130.458 14.8438 129.586 15.2344 128.492 15.2344C127.398 15.2344 126.526 14.8438 125.875 14.0625C125.224 13.2812 124.898 12.2734 124.898 11.0391ZM126.109 10.7891V11.0391C126.109 11.8828 126.31 12.5964 126.711 13.1797C127.112 13.7578 127.706 14.0469 128.492 14.0469C129.284 14.0469 129.88 13.7578 130.281 13.1797C130.682 12.5964 130.883 11.8828 130.883 11.0391V10.7891C130.883 9.94531 130.682 9.23438 130.281 8.65625C129.88 8.07292 129.284 7.78125 128.492 7.78125C127.706 7.78125 127.112 8.07292 126.711 8.65625C126.31 9.23438 126.109 9.94531 126.109 10.7891ZM133.891 15V6.82812H134.961L135.008 7.89844H135.047C135.323 7.51823 135.667 7.21875 136.078 7C136.495 6.78125 136.958 6.67188 137.469 6.67188C138.245 6.67188 138.862 6.90625 139.32 7.375C139.779 7.84375 140.008 8.6276 140.008 9.72656V15H138.82V9.71875C138.82 9.0625 138.672 8.59375 138.375 8.3125C138.083 8.03125 137.667 7.89062 137.125 7.89062C136.661 7.89062 136.255 8.00781 135.906 8.24219C135.562 8.47135 135.286 8.77865 135.078 9.16406V15H133.891ZM141.07 7.9375V6.82812H145.484V7.9375H141.07ZM142.531 12.9609V7.49219V7.26562V4.76562H143.719V12.9609C143.719 13.3307 143.794 13.5964 143.945 13.7578C144.096 13.9141 144.336 13.9922 144.664 13.9922C144.805 13.9922 144.94 13.9766 145.07 13.9453C145.206 13.9141 145.341 13.8724 145.477 13.8203V15C145.357 15.0625 145.198 15.1172 145 15.1641C144.802 15.2109 144.589 15.2344 144.359 15.2344C143.797 15.2344 143.352 15.0547 143.023 14.6953C142.695 14.3307 142.531 13.7526 142.531 12.9609ZM147.016 15V6.82812H148.086L148.133 7.96875H148.172C148.375 7.58854 148.646 7.26562 148.984 7C149.323 6.73438 149.727 6.60156 150.195 6.60156C150.31 6.60156 150.43 6.61458 150.555 6.64062C150.68 6.66146 150.768 6.68229 150.82 6.70312V8.04688C150.716 8.02604 150.607 8.01042 150.492 8C150.378 7.98958 150.253 7.98438 150.117 7.98438C149.664 7.98438 149.276 8.09635 148.953 8.32031C148.63 8.54427 148.38 8.82812 148.203 9.17188V15H147.016ZM151.422 12.5938C151.422 11.7656 151.727 11.1224 152.336 10.6641C152.945 10.2005 153.724 9.96875 154.672 9.96875H156.523V9.39844C156.523 8.90885 156.396 8.51302 156.141 8.21094C155.885 7.90365 155.445 7.75 154.82 7.75C154.201 7.75 153.755 7.8776 153.484 8.13281C153.214 8.38802 153.078 8.6849 153.078 9.02344V9.07031H151.906V9.01562C151.906 8.36979 152.169 7.80729 152.695 7.32812C153.221 6.84375 153.943 6.60156 154.859 6.60156C155.766 6.60156 156.466 6.83594 156.961 7.30469C157.461 7.76823 157.711 8.46615 157.711 9.39844V13.125C157.711 13.4635 157.737 13.7839 157.789 14.0859C157.841 14.3828 157.914 14.6458 158.008 14.875V15H156.867C156.789 14.8698 156.721 14.7005 156.664 14.4922C156.607 14.2839 156.568 14.0755 156.547 13.8672C156.359 14.2057 156.055 14.5052 155.633 14.7656C155.211 15.026 154.674 15.1562 154.023 15.1562C153.284 15.1562 152.664 14.9375 152.164 14.5C151.669 14.0573 151.422 13.4219 151.422 12.5938ZM152.609 12.5234C152.609 12.987 152.745 13.349 153.016 13.6094C153.286 13.8698 153.706 14 154.273 14C154.846 14 155.365 13.8047 155.828 13.4141C156.292 13.0182 156.523 12.599 156.523 12.1562V11H154.828C154.094 11 153.539 11.138 153.164 11.4141C152.794 11.6849 152.609 12.0547 152.609 12.5234ZM159.445 12.5859H160.633V12.625C160.633 13.099 160.807 13.4557 161.156 13.6953C161.505 13.9349 161.964 14.0547 162.531 14.0547C163.068 14.0547 163.5 13.9375 163.828 13.7031C164.156 13.4688 164.32 13.1667 164.32 12.7969C164.32 12.4375 164.193 12.1458 163.938 11.9219C163.688 11.6979 163.159 11.4818 162.352 11.2734C161.497 11.0495 160.833 10.7604 160.359 10.4062C159.885 10.0521 159.648 9.55208 159.648 8.90625C159.648 8.23438 159.904 7.68229 160.414 7.25C160.93 6.81771 161.62 6.60156 162.484 6.60156C163.344 6.60156 164.034 6.82031 164.555 7.25781C165.076 7.69531 165.336 8.29948 165.336 9.07031V9.11719H164.156V9.04688C164.156 8.65104 164.016 8.34115 163.734 8.11719C163.458 7.89323 163.042 7.78125 162.484 7.78125C161.927 7.78125 161.521 7.88542 161.266 8.09375C161.01 8.29688 160.883 8.5625 160.883 8.89062C160.883 9.21354 161.026 9.47396 161.312 9.67188C161.599 9.86458 162.156 10.0651 162.984 10.2734C163.812 10.4818 164.445 10.7786 164.883 11.1641C165.326 11.5443 165.547 12.0833 165.547 12.7812C165.547 13.4844 165.294 14.0703 164.789 14.5391C164.284 15.0026 163.529 15.2344 162.523 15.2344C161.518 15.2344 160.753 14.9974 160.227 14.5234C159.706 14.0495 159.445 13.4167 159.445 12.625V12.5859ZM166.18 7.9375V6.82812H170.594V7.9375H166.18ZM167.641 12.9609V7.49219V7.26562V4.76562H168.828V12.9609C168.828 13.3307 168.904 13.5964 169.055 13.7578C169.206 13.9141 169.445 13.9922 169.773 13.9922C169.914 13.9922 170.049 13.9766 170.18 13.9453C170.315 13.9141 170.451 13.8724 170.586 13.8203V15C170.466 15.0625 170.307 15.1172 170.109 15.1641C169.911 15.2109 169.698 15.2344 169.469 15.2344C168.906 15.2344 168.461 15.0547 168.133 14.6953C167.805 14.3307 167.641 13.7526 167.641 12.9609Z" fill="#565E6A" style="fill:#565E6A;fill:color(display-p3 0.3390 0.3689 0.4171);fill-opacity:1;"/>
<path d="M235 80.3359L246.375 80.3359L246.375 81.5625L241.484 81.5625L241.484 87.2812L246.375 87.2812L246.375 88.5L235 88.5L235 87.2812L240.25 87.2812L240.25 81.5625L235 81.5625L235 80.3359ZM235 91.0391L243.172 91.0391L243.172 92.2187L235 92.2187L235 91.0391ZM245.711 90.7969C245.935 90.7969 246.122 90.8672 246.273 91.0078C246.43 91.1536 246.508 91.3594 246.508 91.625C246.508 91.8958 246.43 92.1016 246.273 92.2422C246.122 92.3828 245.935 92.4531 245.711 92.4531C245.487 92.4531 245.297 92.3828 245.141 92.2422C244.99 92.1016 244.914 91.8958 244.914 91.625C244.914 91.3594 244.99 91.1536 245.141 91.0078C245.297 90.8672 245.487 90.7969 245.711 90.7969ZM232.797 94.4219L233.852 95.3047C233.596 95.5182 233.367 95.8177 233.164 96.2031C232.956 96.5937 232.852 97.0339 232.852 97.5234C232.852 98.1536 233.055 98.6719 233.461 99.0781C233.862 99.4844 234.432 99.6875 235.172 99.6875L235.984 99.6875C235.635 99.4531 235.357 99.138 235.148 98.7422C234.945 98.3464 234.844 97.8724 234.844 97.3203C234.844 96.3307 235.232 95.5469 236.008 94.9687C236.784 94.3906 237.768 94.1016 238.961 94.1016L239.211 94.1016C240.404 94.1016 241.388 94.3906 242.164 94.9687C242.94 95.5469 243.328 96.3307 243.328 97.3203C243.328 97.888 243.208 98.3802 242.969 98.7969C242.729 99.2135 242.435 99.5208 242.086 99.7187L242.086 99.7578L243.172 99.8047L243.172 100.875L235.172 100.875C234.016 100.875 233.13 100.557 232.516 99.9219C231.901 99.2917 231.594 98.487 231.594 97.5078C231.594 96.8724 231.711 96.2839 231.945 95.7422C232.174 95.2057 232.458 94.7656 232.797 94.4219ZM238.961 95.3125C238.133 95.3125 237.437 95.4922 236.875 95.8516C236.312 96.2161 236.031 96.7891 236.031 97.5703C236.031 98.0911 236.174 98.5339 236.461 98.8984C236.747 99.263 237.065 99.526 237.414 99.6875L240.758 99.6875C241.122 99.5208 241.443 99.2552 241.719 98.8906C242 98.5312 242.141 98.0911 242.141 97.5703C242.141 96.7891 241.859 96.2161 241.297 95.8516C240.734 95.4922 240.039 95.3125 239.211 95.3125L238.961 95.3125ZM235 103.172L246.969 103.172L246.969 104.359L242.141 104.359C242.521 104.635 242.812 104.984 243.016 105.406C243.224 105.828 243.328 106.299 243.328 106.82C243.328 107.549 243.094 108.143 242.625 108.602C242.156 109.06 241.375 109.289 240.281 109.289L235 109.289L235 108.102L240.281 108.102C240.937 108.102 241.406 107.953 241.687 107.656C241.969 107.365 242.109 106.951 242.109 106.414C242.109 105.945 241.992 105.534 241.758 105.18C241.523 104.831 241.211 104.557 240.82 104.359L235 104.359L235 103.172ZM240.328 115.102L241.047 115.102C242.802 115.102 244.167 115.521 245.141 116.359C246.12 117.203 246.609 118.263 246.609 119.539C246.609 120.805 246.24 121.794 245.5 122.508C244.76 123.227 243.865 123.586 242.812 123.586L242.727 123.586L242.727 122.367L242.812 122.367C243.521 122.362 244.117 122.125 244.602 121.656C245.086 121.187 245.328 120.482 245.328 119.539C245.328 118.602 244.969 117.833 244.25 117.234C243.536 116.635 242.469 116.336 241.047 116.336L240.328 116.336C238.99 116.336 237.94 116.635 237.18 117.234C236.424 117.833 236.047 118.602 236.047 119.539C236.047 120.445 236.292 121.128 236.781 121.586C237.271 122.049 237.865 122.307 238.562 122.359L238.648 122.367L238.648 123.586L238.562 123.586C237.516 123.508 236.62 123.13 235.875 122.453C235.135 121.776 234.766 120.805 234.766 119.539C234.766 118.258 235.253 117.198 236.227 116.359C237.206 115.521 238.573 115.102 240.328 115.102ZM238.961 124.898L239.211 124.898C240.445 124.898 241.451 125.224 242.227 125.875C243.008 126.526 243.398 127.398 243.398 128.492C243.398 129.586 243.008 130.458 242.227 131.109C241.451 131.766 240.445 132.094 239.211 132.094L238.961 132.094C237.727 132.094 236.719 131.766 235.937 131.109C235.156 130.458 234.766 129.586 234.766 128.492C234.766 127.398 235.156 126.526 235.937 125.875C236.719 125.224 237.727 124.898 238.961 124.898ZM239.211 126.109L238.961 126.109C238.117 126.109 237.404 126.31 236.82 126.711C236.242 127.112 235.953 127.706 235.953 128.492C235.953 129.284 236.242 129.88 236.82 130.281C237.404 130.682 238.117 130.883 238.961 130.883L239.211 130.883C240.055 130.883 240.766 130.682 241.344 130.281C241.927 129.88 242.219 129.284 242.219 128.492C242.219 127.706 241.927 127.112 241.344 126.711C240.766 126.31 240.055 126.109 239.211 126.109ZM235 133.891L243.172 133.891L243.172 134.961L242.102 135.008L242.102 135.047C242.482 135.323 242.781 135.667 243 136.078C243.219 136.495 243.328 136.958 243.328 137.469C243.328 138.245 243.094 138.862 242.625 139.32C242.156 139.779 241.372 140.008 240.273 140.008L235 140.008L235 138.82L240.281 138.82C240.937 138.82 241.406 138.672 241.687 138.375C241.969 138.083 242.109 137.667 242.109 137.125C242.109 136.661 241.992 136.255 241.758 135.906C241.529 135.562 241.221 135.286 240.836 135.078L235 135.078L235 133.891ZM242.062 141.07L243.172 141.07L243.172 145.484L242.062 145.484L242.062 141.07ZM237.039 142.531L242.508 142.531L242.734 142.531L245.234 142.531L245.234 143.719L237.039 143.719C236.669 143.719 236.404 143.794 236.242 143.945C236.086 144.096 236.008 144.336 236.008 144.664C236.008 144.805 236.023 144.94 236.055 145.07C236.086 145.206 236.128 145.341 236.18 145.477L235 145.477C234.937 145.357 234.883 145.198 234.836 145C234.789 144.802 234.766 144.589 234.766 144.359C234.766 143.797 234.945 143.352 235.305 143.023C235.669 142.695 236.247 142.531 237.039 142.531ZM235 147.016L243.172 147.016L243.172 148.086L242.031 148.133L242.031 148.172C242.411 148.375 242.734 148.646 243 148.984C243.266 149.323 243.398 149.727 243.398 150.195C243.398 150.31 243.385 150.43 243.359 150.555C243.339 150.68 243.318 150.768 243.297 150.82L241.953 150.82C241.974 150.716 241.99 150.607 242 150.492C242.01 150.378 242.016 150.253 242.016 150.117C242.016 149.664 241.904 149.276 241.68 148.953C241.456 148.63 241.172 148.38 240.828 148.203L235 148.203L235 147.016ZM237.406 151.422C238.234 151.422 238.878 151.727 239.336 152.336C239.799 152.945 240.031 153.724 240.031 154.672L240.031 156.523L240.602 156.523C241.091 156.523 241.487 156.396 241.789 156.141C242.096 155.885 242.25 155.445 242.25 154.82C242.25 154.201 242.122 153.755 241.867 153.484C241.612 153.214 241.315 153.078 240.977 153.078L240.93 153.078L240.93 151.906L240.984 151.906C241.63 151.906 242.193 152.169 242.672 152.695C243.156 153.221 243.398 153.943 243.398 154.859C243.398 155.766 243.164 156.466 242.695 156.961C242.232 157.461 241.534 157.711 240.602 157.711L236.875 157.711C236.536 157.711 236.216 157.737 235.914 157.789C235.617 157.841 235.354 157.914 235.125 158.008L235 158.008L235 156.867C235.13 156.789 235.299 156.721 235.508 156.664C235.716 156.607 235.924 156.568 236.133 156.547C235.794 156.359 235.495 156.055 235.234 155.633C234.974 155.211 234.844 154.674 234.844 154.023C234.844 153.284 235.062 152.664 235.5 152.164C235.943 151.669 236.578 151.422 237.406 151.422ZM237.477 152.609C237.013 152.609 236.651 152.745 236.391 153.016C236.13 153.286 236 153.706 236 154.273C236 154.846 236.195 155.365 236.586 155.828C236.982 156.292 237.401 156.523 237.844 156.523L239 156.523L239 154.828C239 154.094 238.862 153.539 238.586 153.164C238.315 152.794 237.945 152.609 237.477 152.609ZM237.414 159.445L237.414 160.633L237.375 160.633C236.901 160.633 236.544 160.807 236.305 161.156C236.065 161.505 235.945 161.964 235.945 162.531C235.945 163.068 236.062 163.5 236.297 163.828C236.531 164.156 236.833 164.32 237.203 164.32C237.562 164.32 237.854 164.193 238.078 163.937C238.302 163.687 238.518 163.159 238.727 162.352C238.951 161.497 239.24 160.833 239.594 160.359C239.948 159.885 240.448 159.648 241.094 159.648C241.766 159.648 242.318 159.904 242.75 160.414C243.182 160.93 243.398 161.62 243.398 162.484C243.398 163.344 243.18 164.034 242.742 164.555C242.305 165.076 241.701 165.336 240.93 165.336L240.883 165.336L240.883 164.156L240.953 164.156C241.349 164.156 241.659 164.016 241.883 163.734C242.107 163.458 242.219 163.042 242.219 162.484C242.219 161.927 242.115 161.521 241.906 161.266C241.703 161.01 241.437 160.883 241.109 160.883C240.786 160.883 240.526 161.026 240.328 161.312C240.135 161.599 239.935 162.156 239.727 162.984C239.518 163.812 239.221 164.445 238.836 164.883C238.456 165.326 237.917 165.547 237.219 165.547C236.516 165.547 235.93 165.294 235.461 164.789C234.997 164.284 234.766 163.529 234.766 162.523C234.766 161.518 235.003 160.753 235.477 160.227C235.951 159.706 236.583 159.445 237.375 159.445L237.414 159.445ZM242.062 166.18L243.172 166.18L243.172 170.594L242.062 170.594L242.062 166.18ZM237.039 167.641L242.508 167.641L242.734 167.641L245.234 167.641L245.234 168.828L237.039 168.828C236.669 168.828 236.404 168.904 236.242 169.055C236.086 169.206 236.008 169.445 236.008 169.773C236.008 169.914 236.023 170.049 236.055 170.18C236.086 170.315 236.128 170.451 236.18 170.586L235 170.586C234.937 170.466 234.883 170.307 234.836 170.109C234.789 169.911 234.766 169.698 234.766 169.469C234.766 168.906 234.945 168.461 235.305 168.133C235.669 167.805 236.247 167.641 237.039 167.641Z" fill="#565E6A" style="fill:#565E6A;fill:color(display-p3 0.3390 0.3689 0.4171);fill-opacity:1;"/>
<defs>
<linearGradient id="paint0_linear_36785_629" x1="125" y1="24" x2="125" y2="226" gradientUnits="userSpaceOnUse">
<stop style="stop-color:white;stop-opacity:0.3;"/>
<stop offset="1" stop-color="white" style="stop-color:white;stop-opacity:1;"/>
</linearGradient>
<pattern id="pattern0_36785_629" patternUnits="userSpaceOnUse" viewBox="-71.4672 -12.386 6.26 11.48" width="3.0990100142979387%" height="5.6831680902160047%" x="100" y="100" patternContentUnits="objectBoundingBox">
<g id="pattern0_36785_629_inner">
<circle cx="-76.7272" cy="-11.386" r="1" fill="#D9D9D9" style="fill:#D9D9D9;fill:color(display-p3 0.8510 0.8510 0.8510);fill-opacity:1;"/>
</g>
<use xlink:href="#pattern0_36785_629_inner" transform="translate(6.26 0)"/>
<use xlink:href="#pattern0_36785_629_inner" transform="translate(3.13 5.74)"/>
<use xlink:href="#pattern0_36785_629_inner" transform="translate(9.39 5.74)"/>
</pattern></defs>
</svg>
  </div>
`;

class ThemeControl extends HTMLElement {
  constructor() {
    super();
      this.attachShadow({ mode: 'open' })
          .appendChild(template.content.cloneNode(true));
      this.anchorSupported = CSS.supports('anchor-name: --test');
    this.slider  = this.shadowRoot.querySelector('.slider');
    this.button  = this.shadowRoot.querySelector('#toggle');
    this.handle  = this.shadowRoot.querySelector('.handle');
    this.handleWidth = 27;
    this.handleHeight = 27;
    this.dragging= false;
    this.onDown = this.onDown.bind(this);
    this.onMove = this.onMove.bind(this);
    this.onUp   = this.onUp.bind(this);
    this.buttonHandler = () => {
      if (this.slider.hasAttribute('popover')) {
        this.slider.showPopover();
      }
    };
    this.handleMobileChange = this.handleMobileChange.bind(this);
  }

  connectedCallback() {
    const storedHue  = parseFloat(localStorage.getItem('brandHue')) || 0;
    const storedStim = parseFloat(localStorage.getItem('stimulationLevel')) || 0.50;
    this.slider.addEventListener('pointerdown', this.onDown);
    window.addEventListener('pointermove', this.onMove);
    window.addEventListener('pointerup',   this.onUp);
    const x = storedHue / 360;
    const minS = 0.5, maxS = 0.9;
    const y = (storedStim - minS) / (maxS - minS);
    this.updateHandle(x, y);
    this.updateVariables(x, y);

    if (!this.anchorSupported) {
      const nav = this.closest('.sidebar');
      if (nav) {
        const height = nav.getBoundingClientRect().height;
        document.documentElement.style.setProperty('--bottom-nav-height', `${height}px`);
      }
    }

    this.mobileQuery = window.matchMedia('(max-width: 800px), (max-height: 500px)');
    this.mobileQuery.addEventListener('change', this.handleMobileChange);
    this.handleMobileChange(this.mobileQuery);

    this.button.addEventListener('click', this.buttonHandler);
  }

  disconnectedCallback() {
    this.slider.removeEventListener('pointerdown', this.onDown);
    window.removeEventListener('pointermove', this.onMove);
    window.removeEventListener('pointerup',   this.onUp);
    if (this.mobileQuery)
      this.mobileQuery.removeEventListener('change', this.handleMobileChange);
    this.button.removeEventListener('click', this.buttonHandler);
  }

  onDown(e) { this.dragging = true; this.updateFromEvent(e); }
  onMove(e) { if (this.dragging) this.updateFromEvent(e); }
  onUp()    { this.dragging = false; }

  updateFromEvent(e) {
    const rect = this.slider.getBoundingClientRect();
    let x = (e.clientX - rect.left) / rect.width;
    let y = (e.clientY - rect.top)  / rect.height;
    x = Math.min(1, Math.max(0, x));
    y = Math.min(1, Math.max(0, y));
    this.updateHandle(x, y);
    this.updateVariables(x, y);
  }

  updateHandle(x, y) {
    const rect = this.slider.getBoundingClientRect();
    const tx = x * rect.width  - this.handleWidth  / 2;
    const ty = y * rect.height - this.handleHeight / 2;
    this.handle.setAttribute('transform', `translate(${tx} ${ty})`);
  }

  updateVariables(x, y) {
    const hueValue = Math.round(x * 360);
    const minS = 0.5, maxS = 0.9;
    const stim = (y * (maxS - minS) + minS).toFixed(2);
    document.documentElement.style.setProperty('--base-hue', hueValue + 'deg');
    document.documentElement.style.setProperty('--stimulation-level', stim);
    localStorage.setItem('brandHue', hueValue);
    localStorage.setItem('stimulationLevel', stim);
  }

  handleMobileChange(e) {
    if (e.matches) {
      this.slider.setAttribute('popover', '');
      this.button.style.display = 'inline-flex';
    } else {
      this.slider.removeAttribute('popover');
      this.button.style.display = 'none';
    }
  }
}

customElements.define('theme-control', ThemeControl);
export default ThemeControl;